$(document).ready(function(){$(function(){$("#fnac").datepicker({format:"dd/mm/yyyy",language:"es"})}),$("#busc").click(function(){rut=$("#rut").val(),$.ajax({type:"post",url:"../../model/persona/seek_persona_ficha.php",data:"r="+rut,beforeSend:function(){$("#msg").html(" Buscando...")},error:function(){alert("Error al ejecutar peticion")},success:function(a){"0"==a?($("#msg").addClass("text-danger"),$("#msg").html(" Esta persona no se encuentra registrada en la base de datos."),$("#fich input").attr("disabled",!0),$("#fich select").attr("disabled",!0),$("#rut").removeAttr("disabled"),$("#busc").removeAttr("disabled")):(a=$.parseJSON(a),null==a.fch?($("#msg").html(""),$("#nom").html(a.nom),$("#grab").removeAttr("disabled"),$("#fich input[type='text']").removeAttr("disabled"),$("#fich input[type='checkbox']").removeAttr("disabled"),$("#fich select").removeAttr("disabled"),$("#grab").removeAttr("disabled")):($("#msg").html(""),$("#nom").html(a.nom),$("#fch").val(a.fch),$("#ec").val(a.ec),$("#fnac").val(a.fnac),$("#tmo").val(a.tmo),$("#pnt").val(a.pnt),$("#gfm").val(a.gfm),$("#dh").val(a.dh),1==a.adm&&$("#adm").prop("checked",!0),1==a.ds&&$("#ds").prop("checked",!0),$("#edit").removeAttr("disabled"),$("#del").removeAttr("disabled"),$("#fich input[type='text']").removeAttr("disabled"),$("#fich input[type='checkbox']").removeAttr("disabled"),$("#fich select").removeAttr("disabled"),$("#rut").attr("disabled",!0)))}}),$.ajax({type:"post",url:"../../model/persona/seek_ficha_factor.php",data:"rut="+rut,success:function(a){datos=$.parseJSON(a),$.each(datos,function(a,b){$("#fich input[id='ch"+b+"']").prop("checked",!0)})}})}),$("#grab").click(function(){var a=$("#rut").val(),j=($("#fch").val(),$("#ec").val(),$("#fnac").val(),$("#tmo").val(),$("#pnt").val(),$("#gfm").val(),$("#adm").is(":checked"),$("#ds").is(":checked"),new Array);$("#fich input[name='ch[]']:checked").each(function(){j.push(this.value)}),$("#res").css("display","none"),$.ajax({type:"post",url:"../../model/persona/insficha.php",data:$("#fich").serialize(),beforeSend:function(){$("#msg").html(" Grabando informaci\xf3n... ")},error:function(){alert("Ocurrio un error")},success:function(b){""!=a?($("#msg").html(""),$("#res").slideDown("fast"),$("#res").addClass("alert alert-success"),$("#res").html(b),$("#res").append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'),$("#fich input:text").val(""),$("#fich input:text").attr("disabled",!0),$("#fich select").val(0),$("#fich select").attr("disabled",!0),$("#fich input:checkbox").prop("checked",!1),$("#fich input:checkbox").attr("disabled",!0),$("#grab").attr("disabled",!0),$("#rut").removeAttr("disabled")):($("#res").slideDown("slow"),$("#res").addClass("alert alert-danger"),$("#res").html(" El rut es un dato obligatorio"))}})}),$("#edit").click(function(){var j=($("#rut").val(),$("#fch").val(),$("#ec").val(),$("#fnac").val(),$("#tmo").val(),$("#pnt").val(),$("#gfm").val(),$("#adm").is(":checked"),$("#ds").is(":checked"),new Array);$("#fich input[name='ch[]']").each(function(){j.push(this.value)}),$.ajax({type:"post",url:"../../model/persona/upficha.php",data:$("#fich").serialize(),success:function(a){$("#res").addClass("alert alert-success"),$("#res").html(a),$("#res").append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'),$("#res").slideDown("fast"),$("#fich input:text").val(""),$("#fich input:text").attr("disabled",!0),$("#fich input:checkbox").prop("checked",!1),$("#fich input:checkbox").attr("disabled",!0),$("#fich select").val(0),$("#fich select").attr("disabled",!0),$("#rut").removeAttr("disabled"),$("#fich input:button").attr("disabled",!0),$("#busc").removeAttr("disabled"),window.scroll(0,1)}})}),$("#del").click(function(){var a="Seguro que desea cancelar?";confirm(a)&&(location.href="../../view/persona/")})});